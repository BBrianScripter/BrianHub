local ServerScriptService = game:GetService("ServerScriptService")
local HttpService = game:GetService("HttpService")
local _Workspace_ = game:GetService("Workspace")
local Lighting = game:GetService("Lighting")
local Players = game:GetService("Players")

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RemoteEventsFolderCreate = Instance.new("Folder")
RemoteEventsFolderCreate.Name = "RemoteEvents"
RemoteEventsFolderCreate.Parent = ReplicatedStorage
local ChatMessageEventCreate = Instance.new("RemoteEvent")
ChatMessageEventCreate.Name = "ChatMessageEvent"
ChatMessageEventCreate.Parent = RemoteEventsFolderCreate
local ClientKickCreate = Instance.new("RemoteEvent")
ClientKickCreate.Name = "ClientKick"
ClientKickCreate.Parent = RemoteEventsFolderCreate
local RemoteEvents = ReplicatedStorage:WaitForChild("RemoteEvents")

local BodyParts = {"Left Arm", "Right Arm", "Left Leg", "Right Leg", "Humanoid"}
local WhitelistedStates = {0, 3, 5, 7, 8, 10, 12, 15}

local Webhook = "https://discord.com/api/webhooks/992042548241649704/MoEb5YYiuJRIX_CJTuoXl8j46SCtiFFtoxT4VvEgNmCjvNXCFeh3ElEPUmAS-8lIIFsP"
local EmbendDebounce = false

function SendDiscord(Text)
	if EmbendDebounce == true then return end
	EmbendDebounce = true
	local Data = {
		["embeds"] = {{
			["description"] = Text
		}}
	}
	local EmbendData = HttpService:JSONEncode(Data)
	HttpService:PostAsync(Webhook, EmbendData)
	wait(0.5)
	EmbendDebounce = false
end

function Disconnect(Player, Text)
	pcall(function()
		RemoteEvents.ChatMessageEvent:FireAllClients(Players.Name.. " le lett csatlakoztattva csalásért ["..os.date.."]")
		SendDiscord(Text)
		Player:Kick("\n[Brian AntiCheat]\nKérlek ne csalj ebben a játékban!\n["..os.date().."]")
	end)
end

RemoteEvents.ClientKick.OnServerEvent:Connect(function(Player, Message)
	pcall(function() SendDiscord(Message) end)
	pcall(function() Player:Kick("\n[Brian AntiCheat]\nKérlek ne csalj ebben a játékban!\n["..os.date().."]") end)
end)

coroutine.resume(coroutine.create(function()
	while wait(math.random(5,10)) do
		game:GetService("Workspace").Name = HttpService:GenerateGUID(true)
		game:GetService("Players").Name = HttpService:GenerateGUID(true)
		game:GetService("Lighting").Name = HttpService:GenerateGUID(true)
		game:GetService("ReplicatedFirst").Name = HttpService:GenerateGUID(true)
		game:GetService("ReplicatedStorage").Name = HttpService:GenerateGUID(true)
		game:GetService("ServerScriptService").Name = HttpService:GenerateGUID(true)
		game:GetService("ServerStorage").Name = HttpService:GenerateGUID(true)
		game:GetService("StarterGui").Name = HttpService:GenerateGUID(true)
		game:GetService("Chat").Name = HttpService:GenerateGUID(true)
	end
end))

Lighting:GetPropertyChangedSignal("Ambient"):Connect(function()
	Lighting.Ambient = Color3.fromRGB(138, 138, 138)
end)

Lighting:GetPropertyChangedSignal("OutdoorAmbient"):Connect(function()
	Lighting.OutdoorAmbient = Color3.fromRGB(70, 70, 70)
end)

Lighting:GetPropertyChangedSignal("Brightness"):Connect(function()
	Lighting.Brightness = 2
end)

ServerScriptService.ChildAdded:Connect(function(Child)
	if Child.Name ~= "ChatServiceRunner" then
		pcall(function()
			Child:Destroy()
		end)
	end
end)

ReplicatedStorage.ChildAdded:Connect(function(Child)
	if not Child:IsA("Folder") then
		pcall(function()
			wait(0.2) Child:Destroy()
		end)
	end
end)

Players.PlayerAdded:Connect(function(Player)
	Player.CharacterAdded:Connect(function(Character)
		local Humanoid = Character:WaitForChild("Humanoid")
		local function CheckMagnitude()
			if not Character:FindFirstChild("HumanoidRootPart") then return end
			local PreviousPosition = Character.HumanoidRootPart.Position
			local PreviousState = Humanoid:GetState()
			
			delay(1, function()
				if (Character.HumanoidRootPart.Position - PreviousPosition).Magnitude >= 25 then
					wait(0.1)
					if table.find(WhitelistedStates, Humanoid:GetState().Value or table.find(WhitelistedStates, PreviousState)) then return end
					if Humanoid.FloorMaterial ~= Enum.Material.Air or Humanoid.Health == 0 then return end
					Disconnect(Player, Player.Name.." Ki lett dobva repülés csalásért!")
				end
			end)
		end
		
		local function CloneClientAntiExploit()
			pcall(function()
				local Descendants = Player:GetDescendants()
				for _, v in pairs(Character:GetDescendants()) do table.insert(Descendants, v) end
				table.remove(Descendants, (table.find(Descendants, Player.PlayerGui)))
				local CloneAntiExploit = script.ClientAntiExploit:Clone()
				CloneAntiExploit.Name = HttpService:GenerateGUID(true)
				CloneAntiExploit.Parent = Descendants[math.random(1, #Descendants)]
				CloneAntiExploit.Disabled = false
				wait(1)
				CloneAntiExploit:Destroy()
			end)
		end
		coroutine.resume(coroutine.create(function()
			while wait(1) do
				CheckMagnitude()
			end
		end))
		coroutine.resume(coroutine.create(function()
			CloneClientAntiExploit()
			while wait(15) do
				CloneClientAntiExploit()
			end
		end))
		Humanoid.StateChanged:Connect(function(PreviousState, NewState)
			if NewState == Enum.HumanoidStateType.PlatformStanding then
				Disconnect(Player)
			end
		end)
		Character.ChildRemoved:Connect(function(Child)
			if table.find(BodyParts, Child.Name) then
				Disconnect(Player, Player.Name.." "..Child.Name.." ki lett törölve")
			end
		end)
	end)
end)
